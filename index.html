<!DOCTYPE html>
<html lang="en" xmlns="//www.w3.org/1999/xhtml">

<head>

    <link rel="stylesheet" type="text/css" href="default.css" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.0/css/all.css"
        integrity="sha384-Mmxa0mLqhmOeaE8vgOSbKacftZcsNYDjQzuCOm6D02luYSzBG8vpaOykv9lFQ51Y" crossorigin="anonymous">
</head>

<body>
    <div id="chart"></div>

    <script src="https://www.google.com/jsapi"></script>
    <script src="echarts.min.js"></script>
    <script src="d3-selection.v1.min.js"></script>
    <script>
        google.load("visualization", "1");
        google.setOnLoadCallback(init);

        global_GSheetID = '1znjlYZavONVrlu-iIFw-s-CxjVAAOdvTSFtHrPcoPO4';

        function data_lists_to_object_array(data) {
            var dummy = [];
            var keys = data[0]
            for (i = 1; i < data.length; i++) {
                var d = {};
                for (j = 0; j < keys.length; j++) {
                    d[keys[j]] = data[i][j];
                }
                dummy.push(d);
            }
            return dummy
        }

        function data_to_lists(ColumnNames, DataArray) {
            return [ColumnNames].concat(DataArray)
        }

        function transpose(matrix) {
            return matrix[0].map((col, i) => matrix.map(row => row[i]));
        }

        function getKeyValues(data, key) {
            var dummy = [];
            for (i = 0; i < data.length; i++) {
                dummy.push(data[i][key])
            }
            return dummy
        }

        function getMax(data, key) {
            return Math.max.apply(Math, data.map(function (o) {
                return o[key];
            }))
        }

        function sortObject(objs, key) {
            return objs.sort((a, b) => (a[key] > b[key]) ? 1 : ((b[key] > a[key]) ? -1 : 0));
        }



        function init() {

            var GSheetID = global_GSheetID
            var GSheetName = 'KormÃ¡nyzat'
            var all_data = [];

            var query1 = new
                google.visualization.Query("https://docs.google.com/spreadsheet/ccc?key=" + GSheetID + '&sheet=' + GSheetName);
            //query.setQuery("select *  where B > 2  ");
            query1.setQuery("");
            query1.send(handleQueryResponse1);

            function handleQueryResponse1(response) {
                var data = response.getDataTable();
                var n_col = 16 //data.getNumberOfColumns();
                var ColumnNames = []
                var DataArray = new Array(data.getNumberOfRows());

                for (var col = 0; col < n_col; col++) {
                    ColumnNames.push(data.getColumnLabel(col))
                }
                for (var row = 0; row < data.getNumberOfRows(); row++) {
                    DataArray[row] = new Array(n_col);
                    for (var col = 0; col < n_col; col++) {
                        DataArray[row][col] = data.getValue(row, col);
                    }
                }

                all_data[GSheetName] = data_to_lists(ColumnNames, DataArray)
                var kormanyzat = data_lists_to_object_array(all_data[GSheetName]);
                sortObject(kormanyzat, 'Datum')

                // FINISHED DATA LOADING

                var chart = echarts.init(d3.select("#chart").node());
                option = {
                    xAxis: {
                        type: 'category',
                        data: getKeyValues(kormanyzat, 'Datum')
                    },
                    yAxis: {
                        type: 'value'
                    },
                    series: [{
                        data: getKeyValues(kormanyzat, 'Esetek szama (RO)'),
                        type: 'line',
                        smooth: true,
                        areaStyle: {
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{
                                offset: 0,
                                color: 'rgb(255, 158, 68)'
                            }, {
                                offset: 1,
                                color: 'rgb(255, 70, 131)'
                            }])
                        }
                    }]
                }

                if (option && typeof option === "object") {
                    chart.setOption(option, true);
                }

            }
        }
    </script>
</body>

</html>